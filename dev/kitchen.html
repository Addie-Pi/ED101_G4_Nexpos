<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <!-- <link rel="stylesheet" href="css/style.css" /> -->
    <link rel="stylesheet" href="./css/style.css" />
    <link rel="stylesheet" href="./css/kitchen.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <title>kitchen</title>
    <style>
      /* 整個日曆 */
      #S_calendarAll{
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        position: absolute;
        top: 500px;
        right: 30%;
        width: 13%;
      }
  
    </style>
  </head>

  <body>
    <!-- 複製以下功能列 -->
     @@include('./app/header.html', {
      "nav5" : "actives" 
    })

    <!-- 複製以上功能列 -->
    <!-- 以下為各分頁內容 -->
    <div class="c-wrapper">
      <div class="tablehead">
        <h1>廚房出餐管理</h1>
      </div>
            <div class="topFunc">
        <a href="./kitchen.html" class="topTablink" style="text-decoration: none;">
          <div class="topTab" id="topTabactives">
            <div class="toptabCaption">出餐<br />管理</div>
          </div>
        </a>
        <a href="#" class="topTablink" style="text-decoration: none;">
          <div class="topTab" >
            <div class="toptabCaption">訂單<br />記錄</div>
          </div>
        </a>
      </div>
      <!-- 以下為訂單 -->
      <div class="kPageContainer">
        <div class="kContainer" id="kOrder">
          <div class="kpin"><i class="fa fa-thumb-tack" aria-hidden="true"></i></div>
          <div class="kHead">
            <div class="kHeadItem">
              <h1>訂單：A10</h1>
              <span>2020/06/02 10:26</span>
            </div>
            <div class="kHeadItem">
              <h1>外帶：008</h1>
              <span>店員：Lily</span>
            </div>
          </div>

          <div class="kFood">
            <div class="kFoodBar">項 目</div>
            <ul class="kFoodItem">
              <li>
                <div class="kFoodTitle">
                  <h1 class="kFoodValue"></h1>
                  <span class="kFoodValueTopping"></span>
                </div>
                <div class="kFoodNum">X1</div>
                <div class="kFoodStatus"><i class="fa fa-check" aria-hidden="true"></i></div>
              </li>
            </ul>
          </div>
          <button class="kButton" onclick="foodDone();">訂單完成</button>
        </div>
      </div>

        <!-- <script src="../dev/js/kitchen.js"></script> -->

      <script type="text/javascript">
        //下訂單時寫入
        let ordSaveProdInCartOnHist = [];
        let display = document.querySelector('.kFoodItem') //顯示點餐的品項
        // let displayTopping = document.querySelector('.kFoodValueTopping') //顯示點餐的品項
        localStorage.ordSaveProdInCartOnHist = '[{"PRO_ITEM_NO":"2","PRO_CATA_NO":"1","PRO_ITEM_NAME":"燻雞","PRO_ITEM_PRICE":"45","PRO_ITEM_ONOFF":"1","PRO_PIC":null,"status":1,"state":0,"topping":["生菜 $10","培根 $15","生菜 $10"]},{"PRO_ITEM_NO":"20","PRO_CATA_NO":"3","PRO_ITEM_NAME":"日式燒肉","PRO_ITEM_PRICE":"70","PRO_ITEM_ONOFF":"1","PRO_PIC":null,"status":2,"topping":[]},{"PRO_ITEM_NO":"28","PRO_CATA_NO":"5","PRO_ITEM_NAME":"司康","PRO_ITEM_PRICE":"40","PRO_ITEM_ONOFF":"1","PRO_PIC":null,"status":1,"topping":[]},{"PRO_ITEM_NO":"36","PRO_CATA_NO":"6","PRO_ITEM_NAME":"澳洲小拿鐵","PRO_ITEM_PRICE":"60","PRO_ITEM_ONOFF":"1","PRO_PIC":null,"status":1,"topping":["少冰 $0","正常冰 $0"]}]';

        //出餐時讀出
        ordSaveProdInCartOnHist = JSON.parse(localStorage.ordSaveProdInCartOnHist);//要取出資料時，再透過 JSON.parse() 方法，將資料轉換回原本的格式：
        console.log(ordSaveProdInCartOnHist);

        function show(){//將資料透過map轉化為字串並消除逗號
          display.innerHTML = ordSaveProdInCartOnHist.map((ordSaveProdInCartOnHist,key)=>{//將資料透過map轉化為字串並消除逗號

          if (ordSaveProdInCartOnHist.status == '1'){
            var K = ordSaveProdInCartOnHist.topping
            var L=[];
            for(i=0;i<K.length;i++){
            L.push(K[i].substring(0,K[i].indexOf(" ")));
            }
            return `
              <li>
                <div class="kFoodTitle">
                  <h1 class="kFoodValue">${ordSaveProdInCartOnHist.PRO_ITEM_NAME}</h1>
                  <span class="kFoodValueTopping">${L}</span>
                </div>
                <div class="kFoodNum">X1</div>
                <div class="kFoodStatus"><i class="fa fa-check" aria-hidden="true"></i></div>
              </li>
          `
          }

        }).join('')//將陣列轉出來的逗號刪除
        };
     
        show();

        // 按下送出後：該訂單消失、local storage state訂單改值成1、功能列綠燈閃

        function foodDone(){
          //該單畫面不見
          let kOrder = $("#kOrder");
          kOrder.css('display' , 'none');
          //state改值:1
          // var objs = JSON.parse('ordSaveProdInCartOnHist');
          // console.log('objs');
          var newVal = {
            'state' : '1'
          }
          var newdata = JSON.stringify(newVal);
          localStorage.setItem('ordSaveProdInCartOnHist' , newdata);
        }


      </script>
  </body>
</html>
