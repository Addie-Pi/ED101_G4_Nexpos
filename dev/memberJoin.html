<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
  <!-- <link rel="stylesheet" href="css/style.css" /> -->
  <link rel="stylesheet" href="./css/style.css" />
  <link rel="stylesheet" href="./css/memberJoin.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <title> 會員資料新增</title>
</head>
<style>
  /* 整個日曆 */
  .S_calendarAll{
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    position: absolute;
    width:16%;
    top:282px;
    right:31%;
  }

</style>
<body>
  <!-- 複製以下功能列 -->
  @@include('./app/header.html', {
  "nav2" : "actives"
  })
  <!-- 複製以上功能列 -->
  <!-- 以下為各分頁內容 -->
  <div class="c-wrapper">
    <div class="tablehead">
      <h1>會員資料新增</h1>
    </div>
    <div class="topFunc">
      <a href="memberSearch.html" class="topTablink" style="text-decoration: none;">
        <div class="topTab">
          <div class="toptabCaption">會員<br />查詢</div>
        </div>
      </a>
      <a href="memberJoin.html" class="topTablink" style="text-decoration: none;">
        <div class="topTab" id="topTabactives">
          <div class="toptabCaption">會員<br />新增</div>
        </div>
      </a>
    </div>
    
    <form method="post" action="memberJoin.php" id="myForm" name="form1">
      <div class="resScrollbar" id="resScrollstyle">
        <div class="resOverflow">
          <table id="resTable">
            <div>
              <tr>
                <td>姓</td>
                <td>名</td>
                <td>性別</td>
                <td>手機</td>
                <td>生日</td>
                <td>email</td>
                <td>身份</td>
                <td>狀態</td>
                <td>點數</td>
                <td></td>
              </tr>

              <tr class="spot">
                <td>
                  <input type="text" class="lastname" id="CUS_LAST" name="CUS_LAST" placeholder="" size="5" required />
                  <span class="regUpdateLastName"></span>
                </td>
                <td>
                  <input type="text" class="firstname" id="CUS_FIRST" name="CUS_FIRST" placeholder="" size="8" required />
                  <span class="regUpdateFirstName"></span>
                </td>
                <td>
                  <select id="CUS_GEN" name="CUS_GEN">
                    <option value="女">女</option>
                    <option value="男">男</option>
                  </select>
                </td>
                <td>
                  <input type="text" class="cell" id="CUS_PHONE" name="CUS_PHONE" placeholder="" size="13" required />
                  <span class="regUpdateCell"></span>
                </td>
                <td>
                  <input type="text" calendarLabel="picked" class="calendarPickDate" id="CUS_BIRTH" name="CUS_BIRTH" placeholder="" size="10"
                    required /> <!--這裡是要填入日期的地方,calendarLabel="picked" class="calendarPickDate"都是必須-->

                </td>
                <div class="S_calendarAll" style="display:none">
                  <div class="yearPickScrollBar" id="yearCalendarSelect"></div>
                  <div class="S_calendarHeader">
                    <button type="button" class="S_calendarTopBtn" calendarToggle="previous"> < </button>
          
                    <div class="S_calendarHeaderTop" calendarLabel="month"></div>
          
                    <button type="button" class="S_calendarTopBtn" calendarToggle="next"> > </button>
                  </div>
                  <div class="S_calendarWeek">
                  <span>一</span>
                  <span>二</span>
                  <span>三</span>
                  <span>四</span>
                  <span>五</span>
                  <span>六</span>
                  <span>日</span>
                  </div>
                  <div class="S_calendarDay" calendarArea="month"></div>
                </div>
                <td>
                  <input type="text" class="email" id="CUS_EMAIL" name="CUS_EMAIL" placeholder="" size="20" required />
                  <span class="regUpdateEmail"></span>
                </td>
                <td>
                  <!-- <input type="text" id="CUS_ID" name="CUS_ID" placeholder="" size="3" required /> -->
                  <select id="CUS_ID" name="CUS_ID">
                    <option value="1">會員</option>
                    <option value="0">非會員</option>
                  </select>
                </td>
                <td>
                  <!-- <input type="text" id="CUS_STATE" name="CUS_STATE" placeholder="" size="3" required /> -->
                  <select id="CUS_STATE" name="CUS_STATE">
                    <option value="1">正常</option>
                    <option value="0">黑名單</option>
                  </select>
                </td>
                <td>
                  <input type="text" class="cuspoint" id="CUS_POINT" name="CUS_POINT" placeholder="0" size="5">
                </td>
                <td>
                  <input class="save" id="butsave" type="submit" src="./assets/save.png" alt="Submit" width="34" /><img
                    class="trashcan" src="./assets/trashcan.png" />
                </td>
              </tr>
            </div>
          </table>
        </div>
      </div>
      <img class="add" src="./assets/add.png" id="btnAddSpot" />
      <!-- <input type="submit" value="submit"> -->
    </form>
  </div>
  <script type="text/javascript">
    function $id(id) {
      return document.getElementById(id);
    }

    function addSpot() {
      let myForm = $id("myForm");
      let resTable = $id("resTable");
      let btnSend = $id("btnSend");
      let spot = document.querySelector(".spot");
      // let resTablehead = document.getElementById("resTablehead");
      // let input = document.getElementsByTagName("input");
      let newSpot = spot.cloneNode(true);
      // resTablehead.appendChild(newSpot);
      // newSpot.style.display="";
      // myForm.insertBefore(newSpot, btnSend);
      // input.value="";
      resTable.appendChild(newSpot);
      newSpot.getElementsByTagName("img")[0].onclick = removeSpot; //加入JS行為


    }

    function removeSpot(e) {

      let resTable = $id("resTable");
      resTable.removeChild(e.target.parentNode.parentNode);
    }

    window.addEventListener("load", function () {
      $id("btnAddSpot").onclick = addSpot;
    });


    //正規表達式
    //name
    let lastname = document.querySelector('.lastname');
    let updateLastName = document.querySelector('.regUpdateLastName');

    lastname.addEventListener('input', inputLastName);

    function inputLastName(e) {
      let inputLastName = e.target.value;
      if (inputLastName && /^[\u4e00-\u9fa5_a-zA-Z]/.test(inputLastName)) {
        updateLastName.textContent = '有效姓名';
        updateLastName.classList.add('success');
        updateLastName.classList.remove('failure');
      } else {
        updateLastName.textContent = '無效姓名';
        updateLastName.classList.remove('success');
        updateLastName.classList.add('failure');
      }
    };


    let firstname = document.querySelector('.firstname');
    let updateFirstName = document.querySelector('.regUpdateFirstName');

    firstname.addEventListener('input', inputFirstName);

    function inputFirstName(e) {
      let inputFirstName = e.target.value;
      if (inputFirstName && /^[\u4e00-\u9fa5_a-zA-Z]/.test(inputFirstName)) {
        updateFirstName.textContent = '有效姓名';
        updateFirstName.classList.add('success');
        updateFirstName.classList.remove('failure');
      } else {
        updateFirstName.textContent = '無效姓名';
        updateFirstName.classList.remove('success');
        updateFirstName.classList.add('failure');
      }
    };


    //cell
    let cell = document.querySelector('.cell');
    let updatecell = document.querySelector('.regUpdateCell');

    cell.addEventListener('input', inputCell);

    function inputCell(e) {
      let inputcell = e.target.value;
      if (inputcell && /[0-9]{10}/.test(inputcell)) {
        updatecell.textContent = '有效電話';
        updatecell.classList.add('success');
        updatecell.classList.remove('failure');
      } else {
        updatecell.textContent = '無效電話';
        updatecell.classList.remove('success');
        updatecell.classList.add('failure');
      }
    };
    //email
    let email = document.querySelector('.email');
    let updateEmail = document.querySelector('.regUpdateEmail');

    email.addEventListener('input', inputEmail);

    function inputEmail(e) {
      let inputemail = e.target.value;
      if (inputemail && /(^\w.*@\w+\.com)/.test(inputemail)) {
        updateEmail.textContent = '有效email';
        updateEmail.classList.add('success');
        updateEmail.classList.remove('failure');
      } else {
        updateEmail.textContent = '無效email';
        updateEmail.classList.remove('success');
        updateEmail.classList.add('failure');
      }
    };


    //ajax save to database
    $(document).ready(function () {
      $('#butsave').on('click', function () {
        $("#butsave").attr("disabled", "disabled");
        //  $(".spot").attr("display", "none");
        var CUS_FIRST = $('#CUS_FIRST').val();
        var CUS_LAST = $('#CUS_LAST').val();
        var CUS_GEN = $('#CUS_GEN').val();
        var CUS_PHONE = $('#CUS_PHONE').val();
        var CUS_BIRTH = $('#CUS_BIRTH').val();
        var CUS_EMAIL = $('#CUS_EMAIL').val();
        var CUS_ID = $('#CUS_ID').val();
        var CUS_STATE = $('#CUS_STATE').val();
        var CUS_POINT = $('#CUS_POINT').val();

        $.ajax({
          url: "../dev/js/memberJoin.php",
          type: "POST",
          data: {
            CUS_PHONE: CUS_PHONE,
            CUS_ID: CUS_ID,
            CUS_STATE: CUS_STATE,
            CUS_FIRST: CUS_FIRST,
            CUS_LAST: CUS_LAST,
            CUS_GEN: CUS_GEN,
            CUS_BIRTH: CUS_BIRTH,
            CUS_EMAIL: CUS_EMAIL,
            CUS_POINT:CUS_POINT
          },
          // cache: false,

          success: function (data) {
            alert('儲存成功！');
            console.log(data);
          }
        });
      })
    });

    
  </script>
  <script src="../dev/js/calendarSmall.js"></script>
  <script>
    window.addEventListener('load', function () {

      Calendar.init({
          disablePastDays: true
      });

    })
  </script>
  <script>
    // 判斷登入人員並顯示於頁面
    window.addEventListener("load", function(){
       let username = sessionStorage.getItem('name');
       
       let loginName = document.querySelector('.user');
       loginName.innerHTML = `Hi! ${username}`;
   })
 </script>

</body>

</html>