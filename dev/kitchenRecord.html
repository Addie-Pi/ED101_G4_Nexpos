<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <!-- <link rel="stylesheet" href="css/style.css" /> -->
    <link rel="stylesheet" href="./css/style.css" />
    <link rel="stylesheet" href="./css/kitchenRecord.css">
    <title>廚房訂單記錄</title>
  </head>

<body>
     <!-- 複製以下功能列 -->
     <div class="header c-sidebar">
    <nav id="sideMenu">
        <div class="light">
            <i class="fa fa-circle" aria-hidden="true"></i>

        </div>
        <ul>
            <a href="./tabShow.html"><li class="@@nav0"><i class="fa fa-home" aria-hidden="true"></i>主畫面</li></a>
            <a href="./reservationCalendar.html"><li class="@@nav1"><i class="fa fa-list-alt" aria-hidden="true"></i>訂位管理</li></a>
            <a href="./memberJoin.html"><li class="@@nav2"><i class="fa fa-users" aria-hidden="true"></i>會員管理</li></a>
            <a href="./orderRecord.html"><li class="@@nav3"><i class="fa fa-calendar" aria-hidden="true"></i>歷史訂單</li></a>
            <div class="func">
                <div class="user">Hi, User</div>
                <div class="date"></div>
                <div class="clock"></div>
            </div>
            <a href="./tabShow.html"><li class="@@nav4"><i class="fa fa-times-circle" aria-hidden="true"></i>關閉餐桌</li></a>
            <a href="./kitchen.html"><li class="actives"><i class="fa fa-cutlery" aria-hidden="true"></i>出餐管理</li></a>
            <a href="./dailyStatement.html"><li class="@@nav6"><i class="fa fa-calculator" aria-hidden="true"></i>日結</li></a>
            <a href="./login.html"><li><i class="fa fa-sign-out" aria-hidden="true"></i>登出</li></a>
        </ul>
    </nav>
</div>


<script>
let el = document.querySelector('.date');
let Today=new Date();
el.textContent = Today.getFullYear()+ " / "+ (Today.getMonth()+1) + " / " + Today.getDate();

let dt = document.querySelector('.clock');

TodayHours = Today.getHours() < 10 ? '0' + Today.getHours() : Today.getHours();
TodayMinutes = Today.getMinutes() < 10 ? '0' + Today.getMinutes() : Today.getMinutes();
dt.textContent = TodayHours + " : " + TodayMinutes;

</script>

    <!-- 複製以上功能列 -->
    <!-- 以下為各分頁內容 -->
    <div class="c-wrapper">
        <div class="tablehead">
          <h1>廚房訂單記錄</h1>
        </div>
              <div class="topFunc">
          <a href="./kitchen.html" class="topTablink" style="text-decoration: none;">
            <div class="topTab">
              <div class="toptabCaption">出餐<br />管理</div>
            </div>
          </a>
          <a href="./kitchenRecord.html" class="topTablink" style="text-decoration: none;">
            <div class="topTab"  id="topTabactives">
              <div class="toptabCaption">訂單<br />記錄</div>
            </div>
          </a>
        </div>
     <!-- 以下為訂單 -->
     <div class="kPageContainer" id="kPageContainer">
        <div class="kContainer" id="kOrder">
            <div class="kpin"><i class="fa fa-thumb-tack" aria-hidden="true"></i></div>
            <div class="kHead">
                <div class="kHeadItem">
                    <h1></h1>
                    <span></span>
                </div>
                <div class="kHeadItem">
                    <h1></h1>
                    <span></span>
                    <span></span>
                </div>
            </div>



            <div class="kFood">
            <!-- <div class="kFoodBar"></div> -->
            <ul class="kFoodItem">
                <li>
                <div class="kFoodTitle">
                    <h1 class="kFoodValue"></h1>
                    <span class="kFoodValueTopping"></span>
                </div>
                <div class="kFoodNum"></div>
                <!-- <div class="kFoodStatus"><i class="fa fa-check" aria-hidden="true"></i></div> -->
                </li>
            </ul>
            </div>
        </div> 

        <form id="myForm">
            <div class="resScrollbar" id="resScrollstyle">
              <div class="resOverflow" id="resOverflow">
                <table>
                    <thead>
                        <tr>
                            <td>日期</td>
                            <td>訂單編號</td>
                            <td>桌號/外帶</td>
                            <td>人數</td>
                            <td>店員</td>
                        </tr>
                    </thead>
                    <tbody  id="resTable">
                        <tr  id="content">
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
              </div>
            </div>
        </form>

    </div>


    <script>
        // var done_${orderNo} = [];

        // get 廚師做好的key, 如果localstorage沒有值就return
        // function load(){
        //     if(!localStorage.getItem('done_${orderNo}')) return 
        //     done_${orderNo} = [JSON.parse(localStorage.getItem('done_${orderNo}'))]
        // }
        // load()

        var tmpBackKitchen = [];
        //確認是否有後廚完成訂單，有渲染內用外帶訂單
        var tmpBackKitchenDone = [];
        var data =[];

        function checkBackKitchenDone(){
        for(var i = 0; i < localStorage.length; i++){
            tmpBackKitchen.push(localStorage.key(i));
        }

        for(j=0;j<tmpBackKitchen.length;j++){
            if(tmpBackKitchen[j].includes('done_')){
                tmpBackKitchenDone.push(tmpBackKitchen[j]);
            }
          }

        }
        checkBackKitchenDone()
       
        data = JSON.parse(localStorage.getItem("data"))
        //跑for迴圈 比對編號跟康哥tmpBackKitchenDone陣列編號一樣的，細項印出來

        var testdatalist = [1,2,3];
        JSON.stringify(testdatalist);
        localStorage.setItem("testdatalist");

        // var data = [
        //     //第一張單
        //     [{
        //             "orderList": 1,
        //             "number": "A1",
        //             "inOrOut": "in",
        //             "date": "2020/06/02 10:26",
        //             "pNum": "5"
        //         },
        //         {
        //             "PRO_ITEM_NO": "2",
        //             "PRO_CATA_NO": "1",
        //             "PRO_ITEM_NAME": "燻雞",
        //             "PRO_ITEM_PRICE": "45",
        //             "PRO_ITEM_ONOFF": "1",
        //             "PRO_PIC": null,
        //             "status": 1,
        //             "state": 0,
        //             "topping": [
        //                 "生菜 $10",
        //                 "培根 $15",
        //                 "生菜 $10"
        //             ]
        //         },
        //         {
        //             "PRO_ITEM_NO": "30",
        //             "PRO_CATA_NO": "3",
        //             "PRO_ITEM_NAME": "日式燒肉",
        //             "PRO_ITEM_PRICE": "70",
        //             "PRO_ITEM_ONOFF": "1",
        //             "PRO_PIC": null,
        //             "status": 2,
        //             "state": 0,
        //             "topping": [
        //                 "生菜 $10"
        //             ]
        //         }
          
            
        //     ],
        //     //第二張單
        //     [{
        //             "orderList": 2,
        //             "number": "B1",
        //             "inOrOut": "in",
        //             "date": "2020/06/02 10:26",
        //             "pNum": "4"
        //         },
        //         {
        //             "PRO_ITEM_NO": "2",
        //             "PRO_CATA_NO": "1",
        //             "PRO_ITEM_NAME": "薯條",
        //             "PRO_ITEM_PRICE": "85",
        //             "PRO_ITEM_ONOFF": "1",
        //             "PRO_PIC": null,
        //             "status": 1,
        //             "state": 0,
        //             "topping": [
        //                 "生菜 $10",
        //                 "培根 $15",
        //                 "生菜 $10"
        //             ]
        //         }
        //     ],
        //     //第三張單
        //     [{
        //             "orderList": 3,
        //             "number": "1",
        //             "inOrOut": "out",
        //             "date": "2020/06/02 10:26",
        //             "pNum": "10"
        //         },
        //         {
        //             "PRO_ITEM_NO": "28",
        //             "PRO_CATA_NO": "5",
        //             "PRO_ITEM_NAME": "司康",
        //             "PRO_ITEM_PRICE": "40",
        //             "PRO_ITEM_ONOFF": "1",
        //             "PRO_PIC": null,
        //             "status": 1,
        //             "state": 0,
        //             "topping": [
        //                 "培根 $15"
        //             ]
        //         },
        //         {
        //             "PRO_ITEM_NO": "36",
        //             "PRO_CATA_NO": "6",
        //             "PRO_ITEM_NAME": "澳洲小拿鐵",
        //             "PRO_ITEM_PRICE": "60",
        //             "PRO_ITEM_ONOFF": "1",
        //             "PRO_PIC": null,
        //             "status": 1,
        //             "state": 0,
        //             "topping": [
        //                 "少冰 $0",
        //                 "正常冰 $0"
        //             ]
        //         },
        //         {
        //             "PRO_ITEM_NO": "44",
        //             "PRO_CATA_NO": "6",
        //             "PRO_ITEM_NAME": "榛果拿鐵",
        //             "PRO_ITEM_PRICE": "60",
        //             "PRO_ITEM_ONOFF": "1",
        //             "PRO_PIC": null,
        //             "status": 1,
        //             "state": 0,
        //             "topping": [
        //                 "少冰 $0",
        //                 "正常冰 $0"
        //             ]
        //         }
        //     ]
        // ];



        for(i=0;i<data.length;i++){ 
                // data[i][0]是訂單基本資料
            if(data[i][0].orderList == tmpBackKitchenDone[0]){

            var el3 = document.getElementById('resTable');
            var content3 = "";
            var content = "";
            var kHead = document.getElementById('kOrder');

            //test 
            //先找出幾張單子
            for (let i = 0; i < data.length; i++) {
                content3 += '<tr class="clicktr">';
                var item = data[i][0];
                content3 += '<td>' + data[i][0]["date"] + '</td><td>'+ data[i][0]["orderList"] + ' </td><td>' + data[i][0]["inOrOut"] + '</td><td>' + data[i][0]["pNum"] + '</td><td>Lily</td>';
                content3 += '</tr>'
            }  

            el3.innerHTML = content3;
                    
            //宣告點擊的該tr

            var clicktr = document.getElementsByClassName('clicktr');
            // console.log(clicktr);
            var test = document.getElementById('myForm');
                
            el3.addEventListener('click',e=>{
                const li = e.target.closest('tr');
                // console.log(Array.from(li.parentNode.children).indexOf(li));
                const thisindex = Array.prototype.indexOf.call(li.parentNode.children,li);
                content = '';
                
                // for (let i = 0; i < data.length; i++) {
                    
                    //最外層html
                    // content += '<div class="kContainer" id="kOrder"><div class="kpin"><i class="fa fa-thumb-tack" aria-hidden="true"></i></div><div class="kHead"><div class="kHeadItem">';
                    //取得餐點(第2層loop)
                    for (let j = 0; j < data[thisindex].length; j++) {
                        //取得配菜陣列
                        if (j > 0) {
                            var item = data[thisindex][j]["topping"];
                            var topping = "";
                            //將配菜塞入html(第3層loop)
                            for (k = 0; k < item.length; k++) {
                                topping += item[k].substring(0,item[k].indexOf(" ")) + ' ';
                            }
                            //底下菜項目名稱
                            content +=  ' <li><div class="kFoodTitle"><h1 class="kFoodValue"> ' + data[thisindex][j]["PRO_ITEM_NAME"] +'</h1><span class="kFoodValueTopping"> '+  topping + '</span></div><div class="kFoodNum">X1</div><div class="kFoodStatus"><i class="fa fa-check" aria-hidden="true"></i></div></li>';
                            
                        }else{
                            //整張訂單
                            content += '<div class="kpin"><i class="fa fa-thumb-tack" aria-hidden="true"></i></div><div class="kHead"><div class="kHeadItem"><h1>訂單：' + data[thisindex][j]["orderList"] + ' </h1><span>' + data[thisindex][j]["date"] + '</span></div>' ;
                            content += ' <div class="kHeadItem"><h1>外帶：008</h1><span>人數：3</span><span>店員：Lily</span></div></div>'
                            content += ' <div class="kFood"><div class="kFoodBar">項 目</div><ul class="kFoodItem">';
                        }

                    }
                    content += '</ul></div>';
                
                    // content += '<button class="kButton" onclick="foodDone();">訂單完成</button></div>';
                // }
                    kOrder.innerHTML = content;
            });


            }
        }

        
        


 


        

    </script>
    <script>
        // 判斷登入人員並顯示於頁面
        window.addEventListener("load", function(){
           let username = sessionStorage.getItem('name');
           
           let loginName = document.querySelector('.user');
           loginName.innerHTML = `Hi! ${username}`;
       })
     </script>

</body>

</html>